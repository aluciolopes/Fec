<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Perfil de Investidor 2.1</title>
    <!-- Tailwind CSS para design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plugin para exibir os rótulos no gráfico -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
    <!-- Fontes do Google -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        #quiz-container, #result-container {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        .hidden-screen {
            opacity: 0;
            transform: scale(0.95);
            display: none;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <main class="bg-white p-6 md:p-10 rounded-2xl shadow-lg max-w-2xl w-full">
        
        <!-- Container do Quiz -->
        <div id="quiz-container">
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800">Descubra seu Perfil de Investidor</h1>
                <p class="text-md md:text-lg text-gray-500 mt-2">Responda às perguntas para começar.</p>
            </header>

            <!-- Barra de Progresso -->
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-6">
                <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>

            <!-- Pergunta Atual -->
            <div id="question-area" class="text-center">
                <h2 id="question-text" class="text-xl font-bold text-gray-700 mb-6 min-h-[56px]"></h2>
                <div id="options-container" class="grid grid-cols-1 gap-4">
                    <!-- Opções serão inseridas aqui -->
                </div>
            </div>
        </div>

        <!-- Container do Resultado -->
        <div id="result-container" class="hidden-screen text-center">
            <header class="mb-6">
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800">Seu Perfil é: <span id="profile-name" class="text-blue-600"></span></h1>
                <p id="profile-description" class="text-md md:text-lg text-gray-500 mt-2"></p>
            </header>
            
            <div class="relative w-full max-w-sm mx-auto h-72 md:h-80 mb-6">
                <canvas id="resultChart"></canvas>
            </div>

            <button onclick="restartQuiz()" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">
                Refazer o Teste
            </button>
        </div>
    </main>

    <script>
        const questions = [
            {
                question: "Qual é o seu principal objetivo ao investir?",
                options: [
                    { text: "Preservar meu patrimônio, evitando perdas.", score: 1 },
                    { text: "Aumentar meu capital com um equilíbrio entre segurança e retorno.", score: 2 },
                    { text: "Maximizar os ganhos, mesmo que isso envolva mais risco.", score: 3 }
                ]
            },
            {
                question: "Como você reagiria se seus investimentos caíssem 20% em um mês?",
                options: [
                    { text: "Venderia tudo para não perder mais.", score: 1 },
                    { text: "Ficaria preocupado, mas manteria a posição.", score: 2 },
                    { text: "Aproveitaria para comprar mais, pois o preço está baixo.", score: 3 }
                ]
            },
            {
                question: "Por quanto tempo você pretende deixar o dinheiro investido?",
                options: [
                    { text: "Até 2 anos.", score: 1 },
                    { text: "Entre 2 e 5 anos.", score: 2 },
                    { text: "Mais de 5 anos.", score: 3 }
                ]
            },
            {
                question: "Qual sua familiaridade com produtos de investimento como ações e fundos?",
                options: [
                    { text: "Baixa, conheço apenas o básico como poupança.", score: 1 },
                    { text: "Média, já ouvi falar e entendo os conceitos gerais.", score: 2 },
                    { text: "Alta, invisto ou estudo o mercado com frequência.", score: 3 }
                ]
            }
        ];

        const profiles = {
            conservador: {
                name: "Conservador",
                description: "Você prioriza a segurança acima de tudo. Sua carteira ideal foca em proteger seu capital.",
                portfolio: { labels: ['Renda Fixa', 'Fundos Imobiliários', 'Renda Variável'], data: [80, 15, 5] }
            },
            moderado: {
                name: "Moderado",
                description: "Você busca um bom equilíbrio entre segurança e rentabilidade, aceitando um risco calculado.",
                portfolio: { labels: ['Renda Fixa', 'Renda Variável', 'Fundos Imobiliários'], data: [50, 30, 20] }
            },
            agressivo: {
                name: "Agressivo",
                description: "Você tem alta tolerância ao risco e busca a máxima rentabilidade no longo prazo.",
                portfolio: { labels: ['Renda Variável', 'Criptoativos', 'Renda Fixa'], data: [60, 20, 20] }
            }
        };

        let currentQuestionIndex = 0;
        let totalScore = 0;
        let resultChartInstance = null;

        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const progressBar = document.getElementById('progress-bar');

        function startQuiz() {
            currentQuestionIndex = 0;
            totalScore = 0;
            displayQuestion();
        }

        function displayQuestion() {
            questionText.style.opacity = 0;
            optionsContainer.style.opacity = 0;

            setTimeout(() => {
                const questionData = questions[currentQuestionIndex];
                questionText.textContent = questionData.question;
                optionsContainer.innerHTML = '';

                questionData.options.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option.text;
                    button.className = "w-full bg-gray-100 text-gray-700 font-semibold py-3 px-4 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-all duration-300";
                    button.onclick = () => selectAnswer(option.score);
                    optionsContainer.appendChild(button);
                });

                const progress = ((currentQuestionIndex) / questions.length) * 100;
                progressBar.style.width = `${progress}%`;

                questionText.style.opacity = 1;
                optionsContainer.style.opacity = 1;
            }, 300);
        }

        function selectAnswer(score) {
            totalScore += score;
            currentQuestionIndex++;

            if (currentQuestionIndex < questions.length) {
                displayQuestion();
            } else {
                progressBar.style.width = '100%';
                showResult();
            }
        }

        function showResult() {
            let profileKey;
            if (totalScore <= 5) {
                profileKey = 'conservador';
            } else if (totalScore <= 9) {
                profileKey = 'moderado';
            } else {
                profileKey = 'agressivo';
            }

            const resultData = profiles[profileKey];

            document.getElementById('profile-name').textContent = resultData.name;
            document.getElementById('profile-description').textContent = resultData.description;

            quizContainer.classList.add('hidden-screen');
            setTimeout(() => {
                resultContainer.style.display = 'block';
                setTimeout(() => resultContainer.classList.remove('hidden-screen'), 50);
            }, 500);
            
            createResultChart(resultData.portfolio);
        }

        function createResultChart(portfolioData) {
            const ctx = document.getElementById('resultChart').getContext('2d');
            
            if (resultChartInstance) {
                resultChartInstance.destroy();
            }

            // Registrar o plugin de datalabels
            Chart.register(ChartDataLabels);

            resultChartInstance = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: portfolioData.labels,
                    datasets: [{
                        data: portfolioData.data,
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.9)',
                            'rgba(239, 68, 68, 0.9)',
                            'rgba(245, 158, 11, 0.9)'
                        ],
                        borderColor: '#fff',
                        borderWidth: 3,
                        hoverOffset: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                font: { size: 14, family: "'Inter', sans-serif" },
                                padding: 20
                            } 
                        },
                        tooltip: {
                            enabled: false // Desabilitar tooltip padrão para focar nos datalabels
                        },
                        // Configuração do plugin datalabels
                        datalabels: {
                            formatter: (value, ctx) => {
                                return value + '%';
                            },
                            color: '#fff',
                            font: {
                                weight: 'bold',
                                size: 16,
                                family: "'Inter', sans-serif"
                            },
                            // Adiciona uma pequena sombra para legibilidade
                            textStrokeColor: 'rgba(0,0,0,0.4)',
                            textStrokeWidth: 2
                        }
                    }
                }
            });
        }

        function restartQuiz() {
            resultContainer.classList.add('hidden-screen');
            setTimeout(() => {
                quizContainer.style.display = 'block';
                setTimeout(() => quizContainer.classList.remove('hidden-screen'), 50);
                startQuiz();
            }, 500);
        }

        document.addEventListener('DOMContentLoaded', startQuiz);
    </script>
</body>
</html>
